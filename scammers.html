<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scammer List | Golden Sugar Dating</title>

  <!-- Fonts + Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --bg-color: #050505;
      --card-bg: #121212;
      --gold-light: #F3E5AB;
      --gold-main: #D4AF37;
      --gold-dark: #AA8C2C;
      --text-white: #ffffff;
      --text-grey: #a0a0a0;
      --muted: #666;
      --border: rgba(255,255,255,0.08);
      --border-strong: rgba(255,255,255,0.14);
      --shadow-gold: 0 0 22px rgba(212, 175, 55, 0.18);
      --radius-soft: 12px;
      --radius-card: 10px;
    }

    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      background: var(--bg-color);
      color: var(--text-white);
      font-family: 'Montserrat', sans-serif;
      line-height: 1.6;
      overflow-x: hidden;
    }

    h1, h2, h3 { font-family: 'Playfair Display', serif; margin: 0; }
    a { color: inherit; text-decoration: none; }

    .gold-text {
      background: linear-gradient(to right, var(--gold-light), var(--gold-main), var(--gold-dark));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
    }

    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 5%;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 50;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      background: linear-gradient(to bottom, rgba(0,0,0,0.88), rgba(0,0,0,0.35));
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    
    header.scrolled { 
      background: rgba(0,0,0,0.92); 
      border-bottom: 1px solid var(--border);
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      letter-spacing: 2px;
      font-size: clamp(1rem, 2.5vw, 1.25rem);
      flex-shrink: 0;
    }
    
    .logo-mark {
      width: 10px;
      height: 10px;
      border: 1px solid rgba(212,175,55,0.8);
      box-shadow: var(--shadow-gold);
      transform: rotate(45deg);
      flex-shrink: 0;
    }

    nav {
      display: flex;
      align-items: center;
    }
    
    nav ul {
      display: flex;
      gap: 18px;
      align-items: center;
      margin: 0;
      padding: 0;
      list-style: none;
    }
    
    nav a {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: rgba(255,255,255,0.88);
      transition: color 0.3s ease;
    }
    
    nav a:hover { color: var(--gold-main); }

    .nav-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-shrink: 0;
    }

    .btn-gold {
      background: linear-gradient(135deg, var(--gold-main), var(--gold-dark));
      color: #000;
      padding: 10px 16px;
      border-radius: 6px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      border: 1px solid var(--gold-main);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      user-select: none;
      font-size: 0.78rem;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .btn-gold:hover {
      background: transparent;
      color: var(--gold-main);
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.35);
      transform: translateY(-2px);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-white);
      padding: 10px 16px;
      border-radius: 6px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      border: 1px solid var(--border-strong);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      user-select: none;
      font-size: 0.78rem;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .btn-ghost:hover {
      border-color: var(--gold-main);
      color: var(--gold-main);
      box-shadow: var(--shadow-gold);
      transform: translateY(-2px);
    }

    .container {
      padding: 90px 5% 70px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Hero */
    .hero {
      border: 1px solid rgba(255,255,255,0.08);
      background:
        radial-gradient(1100px 520px at 50% 0%, rgba(212,175,55,0.12), transparent 60%),
        linear-gradient(to bottom, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: clamp(20px, 4vw, 32px);
    }

    .hero-top {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .kicker {
      display: inline-flex;
      gap: 10px;
      align-items: center;
      font-size: 0.75rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.85);
      border: 1px solid rgba(255,255,255,0.12);
      padding: 10px 14px;
      background: rgba(0,0,0,0.25);
      backdrop-filter: blur(10px);
      border-radius: 6px;
      width: fit-content;
    }

    .hero h1 {
      font-size: clamp(1.8rem, 5vw, 2.8rem);
      margin-top: 16px;
      line-height: 1.2;
    }
    
    .hero p {
      margin-top: 12px;
      color: rgba(255,255,255,0.72);
      max-width: 100%;
      font-size: clamp(0.95rem, 2vw, 1.05rem);
    }

    .hero-ctas {
      margin-top: 20px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .divider {
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(212,175,55,0.25), transparent);
      margin: 24px 0;
    }

    /* Notice blocks */
    .notice-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .notice {
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      border-left: 3px solid #ff6b6b;
      border-radius: 12px;
      padding: 18px;
    }
    
    .notice strong {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    
    .notice p {
      margin: 0;
      color: rgba(255,255,255,0.74);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .promo {
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      border-left: 3px solid var(--gold-main);
      border-radius: 12px;
      padding: 18px;
    }
    
    .promo strong {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
    }
    
    .promo p {
      margin: 10px 0;
      color: rgba(255,255,255,0.72);
      font-size: 0.9rem;
    }

    /* Main grid */
    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      margin-top: 24px;
    }

    .panel {
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      backdrop-filter: blur(12px);
      border-radius: 14px;
      padding: clamp(16px, 3vw, 24px);
    }

    .panel h2 {
      font-size: clamp(1.3rem, 3vw, 1.6rem);
      margin-bottom: 8px;
    }
    
    .panel-sub {
      color: rgba(255,255,255,0.70);
      font-size: 0.92rem;
      line-height: 1.5;
    }

    /* Form fields */
    .field {
      margin-top: 16px;
    }
    
    .field label {
      display: block;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: rgba(255,255,255,0.78);
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .field input,
    .field textarea {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.92);
      outline: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: inherit;
      transition: all 0.3s ease;
    }
    
    .field textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.6;
    }
    
    .field input:focus,
    .field textarea:focus {
      border-color: rgba(212,175,55,0.55);
      box-shadow: 0 0 0 3px rgba(212,175,55,0.12);
    }

    .help {
      margin-top: 8px;
      color: rgba(255,255,255,0.62);
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .alert {
      margin-top: 16px;
      display: none;
      padding: 14px 16px;
      border-left: 3px solid var(--gold-main);
      background: rgba(0,0,0,0.25);
      color: rgba(255,255,255,0.78);
      border-radius: 8px;
      font-size: 0.92rem;
      line-height: 1.5;
    }
    
    .alert.error {
      border-left-color: #ff6b6b;
      color: #ffb3b3;
    }

    /* Table */
    .table-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    .search {
      flex: 1 1 250px;
      min-width: 0;
    }
    
    .count {
      color: rgba(255,255,255,0.65);
      font-size: 0.9rem;
      white-space: nowrap;
    }

    .table-wrap {
      margin-top: 16px;
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 12px;
      overflow-x: auto;
      overflow-y: visible;
      background: rgba(0,0,0,0.25);
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      min-width: 700px;
    }

    thead th {
      text-align: left;
      padding: 14px 12px;
      color: rgba(255,255,255,0.80);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      background: rgba(0,0,0,0.45);
      border-bottom: 1px solid rgba(255,255,255,0.08);
      white-space: nowrap;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    tbody td {
      padding: 14px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.82);
      vertical-align: top;
    }

    tbody tr:hover td {
      background: rgba(255,255,255,0.03);
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(255,255,255,0.10);
      padding: 6px 12px;
      background: rgba(0,0,0,0.25);
      border-radius: 20px;
      font-size: 0.82rem;
      color: rgba(255,255,255,0.78);
      white-space: nowrap;
    }

    .link {
      color: var(--gold-main);
      text-decoration: underline;
      text-underline-offset: 3px;
      transition: all 0.3s ease;
    }
    
    .link:hover {
      color: var(--gold-light);
    }

    .details {
      color: rgba(255,255,255,0.70);
      max-width: 360px;
      line-height: 1.5;
      font-size: 0.88rem;
    }

    .btn-mini {
      padding: 8px 12px;
      font-size: 0.72rem;
    }

    .muted {
      color: rgba(255,255,255,0.65);
    }

    .scroll-hint {
      margin-top: 12px;
      color: rgba(255,255,255,0.55);
      font-size: 0.82rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.82);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 20px;
      backdrop-filter: blur(4px);
    }

    .modal {
      width: min(900px, 100%);
      max-height: 90vh;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(10,10,10,0.95);
      backdrop-filter: blur(14px);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 30px 90px rgba(0,0,0,0.65);
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.35);
      gap: 12px;
      flex-shrink: 0;
    }

    .modal-title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(1.1rem, 2.5vw, 1.3rem);
      letter-spacing: 1px;
      min-width: 0;
    }

    .modal-close {
      width: 40px;
      height: 40px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.25);
      color: rgba(255,255,255,0.85);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      flex-shrink: 0;
      transition: all 0.3s ease;
    }
    
    .modal-close:hover {
      border-color: var(--gold-main);
      color: var(--gold-main);
      box-shadow: var(--shadow-gold);
    }

    .modal-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }
    
    .modal-body img {
      width: 100%;
      max-height: 70vh;
      object-fit: contain;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.30);
    }

    /* Footer note */
    .footer-note {
      margin-top: 20px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.35);
      border-left: 3px solid var(--gold-main);
      border-radius: 12px;
      padding: 18px;
      color: rgba(255,255,255,0.74);
      line-height: 1.6;
      font-size: 0.92rem;
    }
    
    .footer-note strong {
      color: rgba(255,255,255,0.92);
    }

    /* Responsive design */
    @media (min-width: 1024px) {
      .grid {
        grid-template-columns: 0.95fr 1.4fr;
      }
    }

    @media (max-width: 768px) {
      header {
        padding: 12px 4%;
      }
      
      nav {
        display: none;
      }
      
      .nav-actions {
        gap: 8px;
      }
      
      .btn-gold,
      .btn-ghost {
        padding: 8px 12px;
        font-size: 0.7rem;
      }
      
      .btn-gold i,
      .btn-ghost i {
        font-size: 0.85rem;
      }
      
      .container {
        padding: 80px 4% 50px;
      }
      
      .hero {
        padding: 20px 16px;
      }
      
      .hero-ctas {
        flex-direction: column;
        width: 100%;
      }
      
      .hero-ctas .btn-gold,
      .hero-ctas .btn-ghost {
        width: 100%;
        justify-content: center;
      }
      
      .notice-row {
        grid-template-columns: 1fr;
      }
      
      .table-top {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search {
        width: 100%;
      }
      
      .count {
        text-align: center;
      }
      
      .actions {
        justify-content: stretch;
      }
      
      .actions button {
        flex: 1;
      }
      
      .modal {
        max-height: 95vh;
      }
      
      .modal-body {
        padding: 16px;
      }
    }

    @media (max-width: 480px) {
      .logo {
        font-size: 0.95rem;
      }
      
      .logo-text {
        display: none;
      }
      
      .logo-text-mobile {
        display: block;
      }
      
      .btn-ghost span,
      .btn-gold span {
        display: none;
      }
      
      table {
        min-width: 600px;
      }
      
      thead th,
      tbody td {
        padding: 10px 8px;
        font-size: 0.85rem;
      }
      
      .details {
        max-width: 200px;
      }
    }
  </style>
</head>

<body>

<header id="siteHeader" aria-label="Site header">
  <a class="logo" href="/" aria-label="Brand home">
    <span class="logo-mark" aria-hidden="true"></span>
    <div class="logo-text"><span class="gold-text">Golden</span> Sugar Dating</div>
    <div class="logo-text-mobile" style="display:none;"><span class="gold-text">GSD</span></div>
  </a>

  <nav aria-label="Primary navigation">
    <ul>
      <li><a href="/#apply">Apply</a></li>
      <li><a href="/#verify">Verification</a></li>
      <li><a href="/#tiers">Plans</a></li>
      <li><a href="/#profiles">Profiles</a></li>
    </ul>
  </nav>

  <div class="nav-actions">
    <a class="btn-ghost" href="/#apply">
      <i class="fa-solid fa-pen-to-square"></i>
      <span>Apply Now</span>
    </a>
    <a class="btn-gold" id="telegramGroupBtn" href="#" target="_blank" rel="noopener">
      <i class="fa-brands fa-telegram"></i>
      <span>Verified Group</span>
    </a>
  </div>
</header>

<main class="container">

  <section class="hero" aria-label="Scammer list hero">
    <div class="hero-top">
      <div>
        <div class="kicker">
          <i class="fa-solid fa-shield-halved" aria-hidden="true"></i>
          <span>Public Scammer Database</span>
        </div>

        <h1>
          <span class="gold-text">Scammer List</span> & Proof
        </h1>

        <p>
          Report scammers with Telegram + optional proof. Reports are reviewed before appearing publicly.
        </p>

        <div class="hero-ctas">
          <a class="btn-gold" href="/index.html?openApply=1#apply">
  <i class="fa-solid fa-clipboard-check"></i> Real SugarDaddy Apply Now
</a>

          <a class="btn-ghost" href="#report">
            <i class="fa-solid fa-flag"></i> Report a Scammer
          </a>
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="notice-row">
      <div class="notice">
        <strong><i class="fa-solid fa-triangle-exclamation"></i> Safety Warning</strong>
        <p>
          If someone is asking you to pay money, voucher, crypto, gift cards, or anything upfront,
          it's a scam. Be careful.
        </p>
      </div>

      <div class="promo">
        <strong class="gold-text"><i class="fa-brands fa-telegram"></i> Verified SugarDaddy Telegram Group</strong>
        <p class="muted">
          Join the real verified group to avoid impersonators.
        </p>
        <div style="margin-top:14px;">
          <a class="btn-gold btn-mini" id="telegramGroupBtn2" href="#" target="_blank" rel="noopener">
            <i class="fa-brands fa-telegram"></i> Join Verified Group
          </a>
        </div>
      </div>
    </div>
  </section>

  <section class="grid" aria-label="Scammer submission + list">
    <!-- Report form -->
    <div class="panel" id="report">
      <h2>Report a Scammer</h2>
      <div class="panel-sub">Your report goes to review first, then it may be added publicly.</div>

      <div class="field">
        <label for="name">Name *</label>
        <input id="name" placeholder="Scammer name or label" autocomplete="off" />
      </div>

      <div class="field">
        <label for="telegram">Telegram *</label>
        <input id="telegram" placeholder="@username or t.me link" autocomplete="off" />
      </div>

      <div class="field">
        <label for="info">Details (optional)</label>
        <textarea id="info" placeholder="What happened? Add context that helps approve the report."></textarea>
      </div>

      <div class="field">
        <label for="screenshot">Screenshot (optional)</label>
        <input id="screenshot" type="file" accept="image/*" />
        <div class="help">Tip: upload a clear screenshot with the Telegram username visible.</div>
      </div>

      <div class="actions">
        <button class="btn-ghost btn-mini" id="clearBtn" type="button">
          <i class="fa-solid fa-eraser"></i> Clear
        </button>
        <button class="btn-gold" id="submitBtn" type="button">
          <i class="fa-solid fa-paper-plane"></i> Submit for Review
        </button>
      </div>

      <div class="alert" id="submitOk">
        Submitted. Waiting for admin approval.
      </div>
      <div class="alert error" id="submitErr">
        Something went wrong. Please try again.
      </div>
    </div>

    <!-- Approved list table -->
    <div class="panel">
      <h2>Approved Scammers</h2>
      <div class="panel-sub">
        Search the list. Use the Proof button to view evidence.
      </div>

      <div class="table-top">
        <div class="search">
          <div class="field" style="margin-top:0;">
            <label for="search">Search</label>
            <input id="search" placeholder="Search by name or telegram..." />
          </div>
        </div>
        <div class="count" id="countText">Loading...</div>
      </div>

      <div class="table-wrap">
        <table aria-label="Scammer table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Telegram</th>
              <th>Details</th>
              <th>Proof</th>
              <th>Added</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <tr><td colspan="5" class="muted" style="text-align:center;padding:24px;">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <div class="scroll-hint">
        <i class="fa-solid fa-arrows-left-right"></i>
        <span>On mobile, scroll the table sideways to view all columns.</span>
      </div>

      <div class="footer-note">
        <strong>Reminder:</strong> If someone asks for any upfront payment (money, voucher, crypto, gift card),
        it's a scam. Be careful. <br><br>
        Want a real SugarDaddy? <a class="link" href="/#apply">Apply Now</a>.
      </div>
    </div>
  </section>

</main>

<!-- Proof Modal -->
<div class="modal-overlay" id="proofModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="proofTitle">
    <div class="modal-header">
      <div class="modal-title" id="proofTitle">Proof</div>
      <button class="modal-close" id="closeProof" aria-label="Close proof">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="modal-body">
      <img id="proofImg" alt="proof screenshot" src="" />
      <div style="margin-top:16px; display:flex; justify-content:flex-end;">
        <a class="btn-ghost btn-mini" id="openProofNewTab" href="#" target="_blank" rel="noopener">
          <i class="fa-solid fa-up-right-from-square"></i> Open in new tab
        </a>
      </div>
    </div>
  </div>
</div>

<script>
  // Header scroll
  const header = document.getElementById('siteHeader');
  function onScroll() {
    if (window.scrollY > 10) header.classList.add('scrolled');
    else header.classList.remove('scrolled');
  }
  window.addEventListener('scroll', onScroll);
  onScroll();

  // âœ… Put your verified Telegram group link here:
  const VERIFIED_TELEGRAM_GROUP_URL = "https://t.me/GoldenSugarDaddy";
  document.getElementById("telegramGroupBtn").href = VERIFIED_TELEGRAM_GROUP_URL;
  document.getElementById("telegramGroupBtn2").href = VERIFIED_TELEGRAM_GROUP_URL;

  // ---------------------------
  // Supabase + Cloudinary config
  // ---------------------------
  const SUPABASE_URL = "https://efrijmrcuvtwjwgcttou.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_BH_9cL6k97CQ4h1MkVXJjg_edZ2K4iW";

  const CLOUDINARY_CLOUD_NAME = "dcvupaaym";
  const CLOUDINARY_UPLOAD_PRESET = "scammer-reports";

  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // ---------------------------
  // Helpers
  // ---------------------------
  function escapeHtml(s) {
    return String(s || "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;")
      .replaceAll(">","&gt;").replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function fmtDate(iso) {
    try {
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return "-";
      return d.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "2-digit" });
    } catch { return "-"; }
  }

  function normalizeTelegram(t) {
    const s = String(t || "").trim();
    if (!s) return "";
    if (s.startsWith("http")) return s;
    if (s.startsWith("t.me/")) return "https://" + s;
    if (s.startsWith("@")) return "https://t.me/" + s.slice(1);
    return s;
  }

  // ---------------------------
  // Proof modal
  // ---------------------------
  const proofModal = document.getElementById("proofModal");
  const proofImg = document.getElementById("proofImg");
  const closeProof = document.getElementById("closeProof");
  const openProofNewTab = document.getElementById("openProofNewTab");

  function openProof(url, title) {
    document.getElementById("proofTitle").textContent = title || "Proof";
    proofImg.src = url;
    openProofNewTab.href = url;
    proofModal.style.display = "flex";
    proofModal.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  }

  function closeProofFn() {
    proofModal.style.display = "none";
    proofModal.setAttribute("aria-hidden", "true");
    proofImg.src = "";
    openProofNewTab.href = "#";
    document.body.style.overflow = "";
  }

  closeProof.addEventListener("click", closeProofFn);
  proofModal.addEventListener("click", (e) => { if (e.target === proofModal) closeProofFn(); });
  window.addEventListener("keydown", (e) => { if (e.key === "Escape") closeProofFn(); });

  // ---------------------------
  // Load + render approved table
  // ---------------------------
  const tbody = document.getElementById("tbody");
  const search = document.getElementById("search");
  const countText = document.getElementById("countText");

  let approvedCache = [];

  async function loadApproved() {
    const { data, error } = await sb
      .from("scammer_reports")
      .select("id, created_at, name, telegram, info, screenshot_url")
      .eq("status", "approved")
      .order("created_at", { ascending: false })
      .limit(500);

    if (error) {
      tbody.innerHTML = `<tr><td colspan="5" class="muted" style="text-align:center;padding:24px;">Error loading list.</td></tr>`;
      countText.textContent = "0 records";
      return;
    }

    approvedCache = data || [];
    renderTable();
  }

  function renderTable() {
    const q = (search.value || "").toLowerCase().trim();
    const filtered = approvedCache.filter(x =>
      (x.name || "").toLowerCase().includes(q) ||
      (x.telegram || "").toLowerCase().includes(q) ||
      (x.info || "").toLowerCase().includes(q)
    );

    countText.textContent = `${filtered.length} record${filtered.length === 1 ? "" : "s"}`;

    if (!filtered.length) {
      tbody.innerHTML = `<tr><td colspan="5" class="muted" style="text-align:center;padding:24px;">No results found.</td></tr>`;
      return;
    }

    tbody.innerHTML = filtered.map(x => {
      const tgLink = normalizeTelegram(x.telegram);
      const hasProof = !!x.screenshot_url;

      const safeName = escapeHtml(x.name);
      const safeTg = escapeHtml(x.telegram);
      const safeInfo = escapeHtml(x.info || "");
      const safeDate = fmtDate(x.created_at);

      const telegramCell = tgLink.startsWith("http")
        ? `<a class="link" href="${escapeHtml(tgLink)}" target="_blank" rel="noopener">${safeTg}</a>`
        : `<span class="chip"><i class="fa-brands fa-telegram"></i> ${safeTg}</span>`;

      const detailsCell = safeInfo
        ? `<div class="details">${safeInfo.length > 180 ? safeInfo.slice(0, 180) + "..." : safeInfo}</div>`
        : `<span class="muted">-</span>`;

      const proofBtn = hasProof
        ? `<button class="btn-gold btn-mini" data-proof="${escapeHtml(x.screenshot_url)}" data-title="${safeName}">
            <i class="fa-solid fa-image"></i> Proof
           </button>`
        : `<button class="btn-ghost btn-mini" disabled style="opacity:.5; cursor:not-allowed;">
            <i class="fa-solid fa-image"></i> No proof
           </button>`;

      return `
        <tr>
          <td><b>${safeName}</b></td>
          <td>${telegramCell}</td>
          <td>${detailsCell}</td>
          <td>${proofBtn}</td>
          <td class="muted">${safeDate}</td>
        </tr>
      `;
    }).join("");

    // bind proof buttons
    document.querySelectorAll("[data-proof]").forEach(btn => {
      btn.addEventListener("click", () => {
        const url = btn.getAttribute("data-proof");
        const title = btn.getAttribute("data-title");
        openProof(url, `Proof: ${title}`);
      });
    });
  }

  search.addEventListener("input", renderTable);

  // ---------------------------
  // Submit flow (pending)
  // ---------------------------
  const submitBtn = document.getElementById("submitBtn");
  const clearBtn = document.getElementById("clearBtn");
  const okAlert = document.getElementById("submitOk");
  const errAlert = document.getElementById("submitErr");

  function showOk(msg) {
    okAlert.textContent = msg || "Submitted. Waiting for admin approval.";
    okAlert.style.display = "block";
    errAlert.style.display = "none";
    setTimeout(() => { okAlert.style.display = "none"; }, 5000);
  }
  
  function showErr(msg) {
    errAlert.textContent = msg || "Something went wrong. Please try again.";
    errAlert.style.display = "block";
    okAlert.style.display = "none";
  }
  
  function clearAlerts() {
    okAlert.style.display = "none";
    errAlert.style.display = "none";
  }

  clearBtn.addEventListener("click", () => {
    document.getElementById("name").value = "";
    document.getElementById("telegram").value = "";
    document.getElementById("info").value = "";
    document.getElementById("screenshot").value = "";
    clearAlerts();
  });

  async function uploadToCloudinary(file) {
    const form = new FormData();
    form.append("file", file);
    form.append("upload_preset", CLOUDINARY_UPLOAD_PRESET);

    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
      method: "POST",
      body: form
    });
    if (!res.ok) throw new Error("Upload failed");
    const json = await res.json();
    return json.secure_url;
  }

  submitBtn.addEventListener("click", async () => {
    clearAlerts();

    const name = document.getElementById("name").value.trim();
    const telegram = document.getElementById("telegram").value.trim();
    const info = document.getElementById("info").value.trim();
    const file = document.getElementById("screenshot").files?.[0];

    if (!name || !telegram) {
      showErr("Name and Telegram are required.");
      return;
    }

    try {
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Submitting...';

      let screenshot_url = null;
      if (file) {
        if (file.size > 8 * 1024 * 1024) throw new Error("Image too large (max 8MB).");
        screenshot_url = await uploadToCloudinary(file);
      }

      const { error } = await sb.from("scammer_reports").insert([{
        name,
        telegram,
        info: info || null,
        screenshot_url,
        status: "pending"
      }]);

      if (error) throw error;

      showOk("Submitted successfully! Waiting for admin approval.");
      document.getElementById("name").value = "";
      document.getElementById("telegram").value = "";
      document.getElementById("info").value = "";
      document.getElementById("screenshot").value = "";

    } catch (e) {
      showErr(e?.message || "Failed to submit.");
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> Submit for Review';
    }
  });

  // Init
  loadApproved();
</script>

</body>
</html>
